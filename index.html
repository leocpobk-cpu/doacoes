<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Sistema de controle de doa√ß√µes de viveres para a comunidade">
    <meta name="theme-color" content="#667eea">
    <title>Sistema de Doa√ß√µes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 10px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #2196f3;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: clamp(1.3em, 4vw, 1.8em);
            margin-bottom: 5px;
        }

        .header p {
            font-size: clamp(0.85em, 2.5vw, 0.95em);
            opacity: 0.95;
        }

        .content {
            padding: 15px;
        }

        .lista-doacoes {
            list-style: none;
        }

        .item-lista {
            padding: 12px 10px;
            border-bottom: 1px solid #e0e0e0;
            font-size: clamp(0.9em, 2.5vw, 1em);
            line-height: 1.7;
            position: relative;
        }

        .item-lista:hover {
            background: #f9f9f9;
        }

        .item-numero {
            color: #999;
            font-weight: bold;
            display: inline-block;
            min-width: 25px;
        }

        .item-nome {
            font-weight: 600;
            color: #333;
        }

        .item-doacoes {
            color: #2196f3;
            font-weight: 500;
            margin-left: 5px;
        }

        .item-faltam {
            color: #ff5722;
            font-style: italic;
            margin-left: 5px;
        }

        .item-completo {
            background: #e8f5e9 !important;
        }

        .item-completo::after {
            content: '‚úÖ';
            position: absolute;
            right: 15px;
            font-size: 1.2em;
        }

        .btn-doar-linha {
            background: none;
            border: none;
            color: #2196f3;
            cursor: pointer;
            font-size: 0.9em;
            text-decoration: underline;
            padding: 0;
            margin-left: 10px;
            font-family: inherit;
        }

        .btn-doar-linha:hover {
            color: #1976d2;
        }

        .btn-remover {
            background: none;
            border: none;
            color: #f44336;
            cursor: pointer;
            font-size: 0.85em;
            padding: 0 5px;
            margin-left: 5px;
        }

        .resumo {
            background: #e3f2fd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            font-size: clamp(0.85em, 2.5vw, 0.95em);
        }

        .resumo strong {
            color: #1976d2;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 25px 20px;
            border-radius: 10px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            margin-bottom: 15px;
            color: #333;
            font-size: clamp(1.2em, 4vw, 1.5em);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-weight: 600;
            font-size: clamp(0.9em, 2.5vw, 0.95em);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: clamp(0.9em, 2.5vw, 1em);
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2196f3;
        }

        .form-group small {
            display: block;
            color: #999;
            margin-top: 3px;
            font-size: clamp(0.8em, 2vw, 0.85em);
        }

        .form-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-primary {
            background: #2196f3;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: clamp(0.9em, 2.5vw, 1em);
            font-weight: 600;
            font-family: inherit;
        }

        .btn-primary:hover {
            background: #1976d2;
        }

        .btn-secondary {
            background: #ccc;
            color: #333;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: clamp(0.9em, 2.5vw, 1em);
            font-family: inherit;
        }

        .btn-secondary:hover {
            background: #999;
        }

        .info-pix {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            display: none;
        }

        .info-pix strong {
            color: #1976d2;
            display: block;
            margin-bottom: 8px;
            font-size: 1.05em;
        }

        .info-pix p {
            margin: 0;
            color: #333;
            line-height: 1.6;
        }

        @media (max-width: 600px) {
            .content {
                padding: 10px;
            }

            .form-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ù Controle de Doa√ß√µes</h1>
            <p>Lista de viveres necess√°rios</p>
        </div>

        <div class="content">
            <div class="resumo">
                <strong>Resumo:</strong> <span id="resumo-texto">Carregando...</span>
            </div>

            <ul class="lista-doacoes" id="lista-itens">
                <!-- Lista ser√° carregada aqui -->
            </ul>
        </div>
    </div>

    <!-- Modal de Doa√ß√£o -->
    <div id="modal-doacao" class="modal">
        <div class="modal-content">
            <h2>Registrar Doa√ß√£o</h2>
            <form id="form-doacao">
                <input type="hidden" id="item-id">
                
                <div class="form-group">
                    <label>Item:</label>
                    <div id="item-nome-modal" style="padding: 10px; background: #f5f5f5; border-radius: 5px; font-weight: 600; font-size: 1.05em;"></div>
                </div>

                <div class="form-group">
                    <label for="doador-nome">Seu Nome: *</label>
                    <input type="text" id="doador-nome" required placeholder="Digite seu nome">
                </div>

                <div class="form-group">
                    <label for="doador-regiao">Regi√£o (Opcional):</label>
                    <input type="text" id="doador-regiao" placeholder="Ex: R04, R13, Figueiral">
                </div>

                <div class="form-group">
                    <label for="tipo-doacao">Tipo de Doa√ß√£o: *</label>
                    <select id="tipo-doacao" required>
                        <option value="item">Doar o Item</option>
                        <option value="dinheiro">Doar em Dinheiro</option>
                    </select>
                </div>

                <div class="info-pix" id="info-pix">
                    <strong>üì± Dados para PIX:</strong>
                    <p><strong>Chave:</strong> 65 99289-8916</p>
                    <p><strong>Favorecido:</strong> Willem Santos - NUBANK</p>
                </div>

                <div class="form-group" id="grupo-quantidade">
                    <label for="quantidade">Quantidade: *</label>
                    <input type="number" id="quantidade" step="0.01" min="0.01" required>
                    <small id="quantidade-disponivel"></small>
                </div>

                <div class="form-group" id="grupo-valor" style="display: none;">
                    <label for="valor-dinheiro">Valor (R$): *</label>
                    <input type="number" id="valor-dinheiro" step="0.01" min="0.01" placeholder="0.00">
                </div>

                <div class="form-group">
                    <label for="observacao">Observa√ß√£o (Opcional):</label>
                    <input type="text" id="observacao" placeholder="Alguma observa√ß√£o adicional">
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">Registrar</button>
                    <button type="button" class="btn-secondary" onclick="fecharModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ============================================
        // SISTEMA DE ARMAZENAMENTO LOCAL (localStorage)
        // ============================================

        const STORAGE_KEY = 'doacoes_data';
        
        // SENHA DE ADMINISTRADOR (altere para sua senha)
        const SENHA_ADMIN = '0016275784390'; // ‚ö†Ô∏è ALTERE ESTA SENHA!

        // Dados iniciais dos itens
        const ITENS_INICIAIS = [
            { id: 1, descricao: 'Arroz 5KG', quantidade_total: 5, unidade: 'pacotes' },
            { id: 2, descricao: 'Coxa e Sobrecoxa (cortada em 5 peda√ßos)', quantidade_total: 50, unidade: 'kg' },
            { id: 3, descricao: 'Cebola', quantidade_total: 2, unidade: 'kg' },
            { id: 4, descricao: 'Piment√£o Vermelho Grande', quantidade_total: 3, unidade: 'unidades' },
            { id: 5, descricao: 'Piment√£o Amarelo Grande', quantidade_total: 3, unidade: 'unidades' },
            { id: 6, descricao: 'Lata de Milho grande', quantidade_total: 2, unidade: 'latas' },
            { id: 7, descricao: 'Lata de Seleta de Legumes Grande', quantidade_total: 2, unidade: 'latas' },
            { id: 8, descricao: 'Alho', quantidade_total: 1, unidade: 'kg' },
            { id: 9, descricao: '√ìleo', quantidade_total: 10, unidade: 'unidades' },
            { id: 10, descricao: 'Tomate', quantidade_total: 2, unidade: 'kg' },
            { id: 11, descricao: 'Sal', quantidade_total: 1, unidade: 'pacote' },
            { id: 12, descricao: 'Ma√ßo de Cebolinha', quantidade_total: 4, unidade: 'ma√ßos' },
            { id: 13, descricao: 'Ma√ßo de Salsa', quantidade_total: 3, unidade: 'ma√ßos' },
            { id: 14, descricao: 'Cenoura', quantidade_total: 10, unidade: 'kg' },
            { id: 15, descricao: 'Farinha', quantidade_total: 10, unidade: 'kg' },
            { id: 16, descricao: 'Ma√ßo de Couve', quantidade_total: 10, unidade: 'ma√ßos' },
            { id: 17, descricao: 'Margarina', quantidade_total: 1, unidade: 'kg' },
            { id: 18, descricao: 'Calabresa', quantidade_total: 1, unidade: 'pacote' },
            { id: 19, descricao: 'Repolho Grande', quantidade_total: 4, unidade: 'unidades' },
            { id: 20, descricao: 'P√© de Alface', quantidade_total: 10, unidade: 'p√©s' },
            { id: 21, descricao: 'Bandeja de Isopor', quantidade_total: 300, unidade: 'unidades' },
            { id: 22, descricao: 'Garfo', quantidade_total: 300, unidade: 'unidades' },
            { id: 23, descricao: 'Fardo de Refrigerantes', quantidade_total: 7, unidade: 'fardos' }
        ];

        // Doa√ß√µes j√° existentes
        const DOACOES_INICIAIS = [
            { id: 1, item_id: 1, doador_nome: 'Denner', doador_regiao: 'R13', quantidade: 2, tipo: 'item', created_at: new Date().toISOString() },
            { id: 2, item_id: 2, doador_nome: 'Denner', doador_regiao: 'R13', quantidade: 10, tipo: 'item', created_at: new Date().toISOString() },
            { id: 3, item_id: 8, doador_nome: 'Daniel Alves', doador_regiao: 'R09', quantidade: 1, tipo: 'item', created_at: new Date().toISOString() },
            { id: 4, item_id: 11, doador_nome: 'Daniel Alves', doador_regiao: 'R09', quantidade: 1, tipo: 'item', created_at: new Date().toISOString() },
            { id: 5, item_id: 14, doador_nome: 'Dc Lucas', doador_regiao: 'Figueiral', quantidade: 10, tipo: 'item', created_at: new Date().toISOString() },
            { id: 6, item_id: 15, doador_nome: 'Dc Lucas', doador_regiao: 'Figueiral', quantidade: 10, tipo: 'item', created_at: new Date().toISOString() },
            { id: 7, item_id: 16, doador_nome: 'Dc Lucas', doador_regiao: 'Figueiral', quantidade: 10, tipo: 'item', created_at: new Date().toISOString() },
            { id: 8, item_id: 17, doador_nome: 'Daniel Alves', doador_regiao: 'R09', quantidade: 1, tipo: 'item', created_at: new Date().toISOString() },
            { id: 9, item_id: 21, doador_nome: 'Dami√£o', doador_regiao: 'R13', quantidade: 100, tipo: 'item', created_at: new Date().toISOString() },
            { id: 10, item_id: 23, doador_nome: 'Gabriel', doador_regiao: 'R04', quantidade: 1, tipo: 'dinheiro', valor_dinheiro: 40.00, created_at: new Date().toISOString() }
        ];

        let dados = {
            itens: [],
            doacoes: [],
            nextDoacaoId: 11
        };

        // Carrega ou inicializa dados
        function carregarDados() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                dados = JSON.parse(saved);
            } else {
                dados.itens = ITENS_INICIAIS.map(item => ({
                    ...item,
                    quantidade_doada: 0
                }));
                dados.doacoes = [...DOACOES_INICIAIS];
                atualizarQuantidadesDoadas();
                salvarDados();
            }
        }

        // Salva dados no localStorage
        function salvarDados() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dados));
        }

        // Reseta todos os dados (APENAS ADMINISTRADOR)
        function resetarDados() {
            const senha = prompt('üîê Esta a√ß√£o requer senha de administrador:');
            if (!senha) return;
            
            if (senha !== SENHA_ADMIN) {
                alert('‚ùå Senha incorreta! Acesso negado.');
                return;
            }
            
            if (confirm('‚ö†Ô∏è Tem certeza que deseja apagar TODAS as doa√ß√µes e recome√ßar do zero?')) {
                localStorage.removeItem(STORAGE_KEY);
                alert('‚úÖ Dados resetados! A p√°gina ser√° recarregada.');
                location.reload();
            }
        }

        // Atualiza quantidade doada de cada item
        function atualizarQuantidadesDoadas() {
            dados.itens.forEach(item => {
                item.quantidade_doada = dados.doacoes
                    .filter(d => d.item_id === item.id)
                    .reduce((sum, d) => sum + d.quantidade, 0);
            });
        }

        // Carrega itens com doa√ß√µes
        function carregarItens() {
            atualizarQuantidadesDoadas();
            
            const itensComDoacoes = dados.itens.map(item => {
                const doacoesItem = dados.doacoes.filter(d => d.item_id === item.id);
                const percentual = Math.min(100, (item.quantidade_doada * 100) / item.quantidade_total);
                
                return {
                    ...item,
                    doacoes: doacoesItem,
                    percentual_doado: percentual
                };
            });

            renderizarItens(itensComDoacoes);
            atualizarResumo();
        }

        // Renderiza todos os itens em formato de lista simples
        function renderizarItens(itens) {
            const container = document.getElementById('lista-itens');
            
            if (itens.length === 0) {
                container.innerHTML = '<li style="text-align:center;color:#999;">Nenhum item encontrado</li>';
                return;
            }

            container.innerHTML = itens.map((item, index) => {
                const restante = item.quantidade_total - item.quantidade_doada;
                const completo = restante <= 0;
                
                // Monta texto das doa√ß√µes
                let textoDoacoes = '';
                if (item.doacoes.length > 0) {
                    textoDoacoes = item.doacoes.map(d => {
                        let texto = `${d.doador_nome} ${d.doador_regiao ? d.doador_regiao : ''}`;
                        if (d.tipo === 'dinheiro') {
                            texto += ` R$ ${d.valor_dinheiro.toFixed(2)}`;
                        } else {
                            texto += ` ${d.quantidade} ${item.unidade}`;
                        }
                        return `${texto} <button class="btn-remover" onclick="removerDoacao(${d.id})" title="Remover (somente admin)">üóëÔ∏è</button>`;
                    }).join(', ');
                }
                
                // Monta texto de faltam
                let textoFaltam = '';
                if (!completo && item.doacoes.length > 0) {
                    textoFaltam = `<span class="item-faltam">(Faltam ${restante} ${item.unidade})</span>`;
                }

                return `
                    <li class="item-lista ${completo ? 'item-completo' : ''}">
                        <span class="item-numero">${index + 1}.</span>
                        <span class="item-nome">${item.quantidade_total} ${item.unidade} de ${item.descricao.toLowerCase()}</span>
                        ${textoDoacoes ? ` - <span class="item-doacoes">${textoDoacoes}</span>` : ''}
                        ${textoFaltam}
                        ${!completo ? `<button class="btn-doar-linha" onclick="abrirModalDoacao(${item.id})">Doar</button>` : ''}
                    </li>
                `;
            }).join('');
        }

        // Atualiza resumo no topo
        function atualizarResumo() {
            const completos = dados.itens.filter(i => i.quantidade_doada >= i.quantidade_total).length;
            const pendentes = dados.itens.filter(i => i.quantidade_doada === 0).length;
            const doadores = new Set(dados.doacoes.map(d => d.doador_nome)).size;
            const totalDinheiro = dados.doacoes
                .filter(d => d.tipo === 'dinheiro')
                .reduce((sum, d) => sum + (d.valor_dinheiro || 0), 0);

            const texto = `${completos} itens completos, ${pendentes} pendentes ‚Ä¢ ${doadores} doadores ‚Ä¢ R$ ${totalDinheiro.toFixed(2)} em dinheiro`;
            document.getElementById('resumo-texto').textContent = texto;
        }

        // Abre modal de doa√ß√£o
        function abrirModalDoacao(itemId) {
            const item = dados.itens.find(i => i.id === itemId);
            if (!item) return;

            const restante = item.quantidade_total - item.quantidade_doada;
            
            document.getElementById('item-id').value = itemId;
            document.getElementById('item-nome-modal').textContent = item.descricao;
            document.getElementById('quantidade').max = restante;
            document.getElementById('quantidade').value = restante > 1 ? 1 : restante.toFixed(2);
            document.getElementById('quantidade-disponivel').textContent = `Restam: ${restante.toFixed(2)} ${item.unidade}`;
            document.getElementById('modal-doacao').classList.add('active');
            
            // Foca no campo nome para facilitar uso mobile
            setTimeout(() => document.getElementById('doador-nome').focus(), 300);
        }

        // Fecha modal
        function fecharModal() {
            document.getElementById('modal-doacao').classList.remove('active');
            document.getElementById('form-doacao').reset();
            document.getElementById('grupo-valor').style.display = 'none';
            document.getElementById('info-pix').style.display = 'none';
            document.getElementById('grupo-quantidade').style.display = 'block';
        }

        // Alterna tipo de doa√ß√£o
        document.getElementById('tipo-doacao').addEventListener('change', (e) => {
            const isDinheiro = e.target.value === 'dinheiro';
            document.getElementById('grupo-valor').style.display = isDinheiro ? 'block' : 'none';
            document.getElementById('info-pix').style.display = isDinheiro ? 'block' : 'none';
            document.getElementById('grupo-quantidade').style.display = isDinheiro ? 'none' : 'block';
            document.getElementById('valor-dinheiro').required = isDinheiro;
            document.getElementById('quantidade').required = !isDinheiro;
        });

        // Envia doa√ß√£o
        document.getElementById('form-doacao').addEventListener('submit', (e) => {
            e.preventDefault();

            const itemId = parseInt(document.getElementById('item-id').value);
            const item = dados.itens.find(i => i.id === itemId);
            const quantidade = parseFloat(document.getElementById('quantidade').value);
            const restante = item.quantidade_total - item.quantidade_doada;

            if (quantidade > restante) {
                alert(`‚ùå Quantidade excede o dispon√≠vel. Restam apenas ${restante.toFixed(2)} ${item.unidade}`);
                return;
            }

            const novaDoacao = {
                id: dados.nextDoacaoId++,
                item_id: itemId,
                doador_nome: document.getElementById('doador-nome').value.trim(),
                doador_regiao: document.getElementById('doador-regiao').value.trim() || null,
                quantidade: quantidade,
                tipo: document.getElementById('tipo-doacao').value,
                valor_dinheiro: document.getElementById('tipo-doacao').value === 'dinheiro' 
                    ? parseFloat(document.getElementById('valor-dinheiro').value) 
                    : null,
                observacao: document.getElementById('observacao').value.trim() || null,
                created_at: new Date().toISOString()
            };

            dados.doacoes.push(novaDoacao);
            salvarDados();

            alert('‚úÖ Doa√ß√£o registrada com sucesso!');
            fecharModal();
            carregarItens();
        });

        // Remove doa√ß√£o (APENAS ADMINISTRADOR)
        function removerDoacao(doacaoId) {
            const senha = prompt('üîê Esta a√ß√£o requer senha de administrador:');
            if (!senha) return;
            
            if (senha !== SENHA_ADMIN) {
                alert('‚ùå Senha incorreta! Apenas administradores podem remover doa√ß√µes.');
                return;
            }
            
            if (!confirm('Tem certeza que deseja remover esta doa√ß√£o?')) return;

            dados.doacoes = dados.doacoes.filter(d => d.id !== doacaoId);
            salvarDados();

            alert('‚úÖ Doa√ß√£o removida com sucesso!');
            carregarItens();
        }

        // Fecha modal ao clicar fora
        document.getElementById('modal-doacao').addEventListener('click', (e) => {
            if (e.target.id === 'modal-doacao') {
                fecharModal();
            }
        });

        // Inicializa ao carregar p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            carregarDados();
            carregarItens();
        });
    </script>
</body>
</html>

